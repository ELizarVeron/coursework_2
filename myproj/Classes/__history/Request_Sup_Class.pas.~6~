unit Request_Sup_Class;

interface
 uses    System.Generics.Collections, Data.Win.ADODB, System.SysUtils, Vcl.Controls,
  Vcl.Forms, Vcl.Dialogs, Vcl.ComCtrls, Vcl.StdCtrls, Vcl.ExtCtrls,
 Agents, History_Of_Reliz,   Request_supplier,
   Supplier,   Main_Class,    Supplier_Class;

type
  TRequest_Sup_Class  = class(TMain_class)
  public
    class var array_of_requests_sup: TObjectList<TRequest_Supplier>;

           constructor Create();
           class    procedure load_frames(Panel1: TPanel; page, count_in_bd: integer);
           function from_ado_to_array_req_sup(ado: tADOQuery): TObjectList<TRequest_Supplier>;
           procedure reload;
           procedure FiltrChange(edit: TEdit; Filtr: TComboBox; sort: TComboBox);
           procedure create_sort(Sortirovka: TComboBox); override;
           procedure create_filter(Filtr: TComboBox); override;

  end;


implementation
uses   Frame_req_sup ;


{ TRequest_Sup_Class }

constructor TRequest_Sup_Class.Create;
begin
      inherited;
 array_of_requests_sup := from_ado_to_array_req_sup(sql_select('*', 'Request_for_supplier','',' order by ID_request_ ',false));
end;

procedure TRequest_Sup_Class.create_filter(Filtr: TComboBox);
begin
   var
    i: integer;
  var
    ado_help: tADOQuery;
  ado_help := tADOQuery.Create(Filtr);
  Filtr.Items.Add('Все');
  ado_help := sql_select(' Status ', ' Request_for_supplier ', '', '', true);
  while not ado_help.Eof do
  begin
    Filtr.Items.Add(ado_help.FieldByName('Status').AsString);
    ado_help.Next
  end;


end;

procedure TRequest_Sup_Class.create_sort(Sortirovka: TComboBox);
begin
    Sortirovka.Items.Add(' ↑ По дате создания');
  Sortirovka.Items.Add(' ↓ По дате создания');

end;

procedure TRequest_Sup_Class.FiltrChange(edit: TEdit; Filtr, sort: TComboBox);
begin

end;

function TRequest_Sup_Class.from_ado_to_array_req_sup(
  ado: tADOQuery): TObjectList<TRequest_Supplier>;
begin
       var
    req: TRequest_supplier;
    var mc:TMain_Class;
        mc:=TMain_Class.Create;
  var
  array_of_requests_sup := TObjectList<TRequest_Supplier>.Create;
  while not ado.Eof do
  begin
    req := TRequest_supplier.Create();
    req.ID_Request := ado.Fields[0].AsInteger;
    req.ID_Sup := ado.Fields[1].AsInteger;
    req.Status:=  ado.Fields[2].AsString;
    req.Date_Of_Create:=ado.Fields[3].AsDateTime;


    req.Company:=mc.sql_select('Title', 'Supplier' , 'where ID = ' + req.ID_Sup.ToString,'',false).Fields[0].AsString; //что бы узнать имя по id




    array_of_requests_sup.Add(req);
    ado.Next;
  end;
  result := array_of_requests_sup;

end;

class procedure TRequest_Sup_Class.load_frames(Panel1: TPanel; page,
  count_in_bd: integer);
begin

end;

procedure TRequest_Sup_Class.reload;
begin

end;

end.
