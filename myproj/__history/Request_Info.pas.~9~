unit Request_Info;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls,Request_Agents_Class,TABLE_Requests_agent,  Data.Win.ADODB, Main_Class,ChangesRequest;

type
  TForm11 = class(TForm)
    ListBox1: TListBox;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Label5: TLabel;
    Label6: TLabel;
    Label4: TLabel;
    Label7: TLabel;
    Label8: TLabel;
    Label9: TLabel;
    Label10: TLabel;
    Button1: TButton;
    Button2: TButton;
    procedure Button2Click(Sender: TObject);
    procedure Button1Click(Sender: TObject);

  private
    { Private declarations }
  public
   var Req_on_frame:  TRequest_agent;
   var need_delete:boolean;
    procedure Do_List;
  end;

var
  Form11: TForm11;

implementation

{$R *.dfm}

procedure TForm11.Button1Click(Sender: TObject);
begin
       var ECHR:TForm15;

       ECHR:=TForm15.Create(self);
       ECHR.Req_on_frame:=Req_on_frame;

       ECHR.init;
       ECHR.ShowModal;
       if( ECHR.need_reload ) then
       begin
          Do_List;
       end;

end;

procedure TForm11.Button2Click(Sender: TObject); //удаление запсии
begin
   var mc:TMain_class;
   mc:=TMain_Class.Create;
   mc.sql_delete(  '  Request_from_agent ' , ' ID_request_agent ' , Req_on_frame.ID_Request.ToString) ;
   var i:integer;
   for I := 0 to  TRequest_Agents_Class.array_of_requests_agent.Count-1 do
    if( TRequest_Agents_Class.array_of_requests_agent[i].ID_Request=Req_on_frame.ID_Request)
    then TRequest_Agents_Class.array_of_requests_agent.Delete(i);
 //  TRequest_Agents_Class.load_frames();
    need_delete:=true;
    Close;

end;
procedure TForm11.Do_List;
begin
       ListBox1.Clear;
   var mc:=TMain_class.Create();
   var  mc2:=TMain_class.Create();

   var  ado_composition:= mc.sql_select(' * ', ' Com  ' , 'where idr =  ' +  Req_on_frame.ID_Request.ToString , '   ' , false );
     if ( ado_composition.IsEmpty) then
     begin
          ListBox1.Visible:=false;
          label9.Caption:='тут пока еще ничего нет...';

     end

     else
     begin
           while not ado_composition.Eof do
      begin
        ListBox1.Visible:=true;
         var ado_nameprod:= mc2.sql_select( ' Name_ ', ' Products ' , 'where Article =  ' +   ado_composition.Fields[1].AsString  , ' ' , false );
         ListBox1.Items.Add( ado_nameprod.Fields[0].AsString + '   '  + ado_composition.Fields[2].AsString + 'шт' );
         ado_composition.Next
      end;


     end;



end;


end.
